{
    "type": "WizardScriptElement",
    "config": {
        "name": "My Custom Script",
        "script": "\n\n\nvar div = new Element('div',{\"id\":\"violationType-filter\", \"class\":\"map-filter regions-filter\"});\n          \n            \n\n         \/\/ div.appendChild(new Asset.image('https:\/\/www2.gov.bc.ca\/assets\/gov\/sports-recreation-arts-and-culture\/'+\n         \/\/ 'outdoor-recreation\/fishing-and-hunting\/hunting\/regulations\/fw_regions_blue_cities.gif')) ; \n\n\n(new AjaxControlQuery(CoreAjaxUrlRoot, \"distinct_attribute_value_list\", {\n        'plugin': \"Attributes\",\n        'table':'regionAttributes',\n        'field':'mu'\n    })).addEvent('success', function(response){\n        div.appendChild(new Element('h2',{html:response.label}))\n        \n        \n        \/\/var names=[];\n        var icons=[];\n        var nameLabel={\n            '1':\"Vancouver Island\",\n            '2':\"Lower Mainland\",\n            '3':\"Thompson-Nicola\",\n            '4':\"Kootenay\",\n            '5':\"Cariboo\",\n            '6':\"Skeena\",\n            '7a':\"Omineca Zone\",\n            '7b':\"Peace Zone\",\n            '8':\"Okanagan\"\n        }\n        \n        var tokens={\n            '1':'bsSbR9GnhfkBRe6',\n            '2':'mi36kQG7la2rDXj',\n            '3':'n4gWOmkkJooFCzL',\n            '4':'7f03ETmhOic3ENX',\n            '5':'lb2v5UrK4iGhllT',\n            '6':'7GxvHvwvHlNrym',\n            '7a':'9vzSWy4o0t0RAP4',\n            '7b':'txnRsN6l9eELgyu',\n            '8':'fMeh0TOPyKeSTd'\n        }\n    \n        \n        var names=response.values.filter(function(v){\n            return v&&v!=='';\n        });\n        \n        names.sort();\n        \n        names.forEach(function(v){\n            if(tokens[v]){\n                 icons.push(\n                '\/php-core-app\/core.php?iam=administrator&format=raw&'+\n                'controller=plugins&view=plugin&plugin=Maps&pluginView=mapitem.icon&filter-token='+tokens[v]+'');\n                return;\n            }\n            icons.push(\n                '\/php-core-app\/core.php?iam=administrator&format=raw&'+\n                'controller=plugins&view=plugin&plugin=Maps&pluginView=mapitem.icon&mapitem=451&nocache=true');\n        });\n        \n  \n            var iconSelection = new UIIconizedSelectionControl(div, {\n              allowMultipleSelection: true,\n              allowEmptySelection: true,\n              icons: icons\n              \n            });\n            \n            \n            iconSelection.addEvent('loadIcon', function(icon, i, asset) {\n              new UIPopover(asset.parentNode, {\n                description: \"click to filter map on region: \"+names[i].capitalize()+\" \"+nameLabel[names[i]],\n                anchor: UIPopover.AnchorTo(['bottom'])\n              });\n              \n              asset.parentNode.setAttribute('data-type', names[i].capitalize()+\" \"+nameLabel[names[i]])\n            }); \n            \n            var filterManager=application.getContentFilterManager();\n            var applyFilter=function(values){\n                \n                \n                if(values.length==0){\n                    filterManager.clear();\n                    \n                    return;\n                }\n                \n                filterManager.search(\n                    map.getContentFilterManager().setDefaultJoin('or').makeFilter(\"regionAttributes\", values.map(function(v) {\n                          return {\n                            field: \"mu\",\n                            comparator: 'equalTo',\n                            value: v\n                          };\n                        })\n                      ),{},function(response, options, filter){\n                          \n                        var layers=Object.keys(response.results.matches);\n                        var items=[];\n                        layers.forEach(function(lid){\n                            items=items.concat(Object.keys(response.results.matches[lid]));\n                        });\n                        console.log(items);\n                        \n                        (new AjaxControlQuery(CoreAjaxUrlRoot, \"search_item_bounds\", {\n                        \t\"plugin\": \"Maps\",\n                        \t\"polygonBounds\":items,\/\/.slice(0,2),\n                        \t\"layer\":11\n                    \t})).addEvent('success',function(bounds){\n                            console.log(bounds.results);\n                            \n                            response.results.matches[\"11\"]={};\n                            bounds.results.forEach(function(item){\n                                 response.results.matches[\"11\"][item['id']]=item;\n                            });\n                            \n                             filterManager.filter.call(filterManager, response, options, filter);\n                    \t}).execute();\n                          \n                       \n                      }\n                      );\n                      \n            };\n            \n            filterManager.addEvent('showItem', function(item){\n                \/\/google maps\n                \/\/item.getMapObject().setOptions({strokeColor:\"cornflowerblue\"});\n            });\n            filterManager.addEvent('hideItem', function(item){\n                \n            })\n            \n            iconSelection.addEvent('selectionChanged', function(selection) {\n\n    \n              applyFilter(selection.map(function(a) {\n                return names[a[1]]\n              }))\n            });\n\n            \n\n            filterManager.addEvent('clear',function(){\n              iconSelection.clearSelection();\n            });\n\n            filterManager.addEvent('filter',function(){\n             \n\n            });\n        \n        \n        \n    }).execute();\n\n\n\n\nreturn div;\n\n\n\n\n",
        "description": "Info about my custom script"
    }
}